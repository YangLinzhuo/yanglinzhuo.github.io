{
    "version": "https://jsonfeed.org/version/1",
    "title": "林•初夏 • All posts by \"wsl\" tag",
    "description": "Linn 的个人博客",
    "home_page_url": "https://linn-ylz.com",
    "items": [
        {
            "id": "https://linn-ylz.com/Computer-Science/Configs/wsl2-cuda-configs/",
            "url": "https://linn-ylz.com/Computer-Science/Configs/wsl2-cuda-configs/",
            "title": "WSL2 下的 CUDA 配置",
            "date_published": "2021-10-08T14:56:26.000Z",
            "content_html": "<h1 id=\"说明\"><a class=\"anchor\" href=\"#说明\">#</a> 说明</h1>\n<p>本文记录  <code>Windows</code>  环境下  <code>WSL2</code>  系统中配置  <code>CUDA</code>  环境的过程。配置过程主要参考这篇<a href=\"https://zhuanlan.zhihu.com/p/350399229\">知乎文章</a>以及<a href=\"https://docs.nvidia.com/cuda/wsl-user-guide/index.html\">官方文档</a>。</p>\n<p>本文内容中省去在  <code>Windows</code>  下安装  <code>WSL2</code>  的过程，这里默认已经安装该环境。如果没有安装  <code>WSL2</code> ，可以参考官方文档中提供的说明。</p>\n<h1 id=\"配置\"><a class=\"anchor\" href=\"#配置\">#</a> 配置</h1>\n<h2 id=\"安装驱动\"><a class=\"anchor\" href=\"#安装驱动\">#</a> 安装驱动</h2>\n<p>参考官方文档中的 <a href=\"https://docs.nvidia.com/cuda/wsl-user-guide/index.html#:~:text=Release%20Preview%20Channel.-,2.3.%C2%A0Installing%20NVIDIA%20Windows%20Drivers%20for%20CUDA%2C%20DirectX%2C%20and%20DirectML%20Support,-Download%20the%20NVIDIA\">2.3 小节</a>。</p>\n<p>下载好驱动之后直接安装，安装选项均为默认值。</p>\n<h2 id=\"安装-cuda\"><a class=\"anchor\" href=\"#安装-cuda\">#</a> 安装  <code>CUDA</code></h2>\n<p>参考官方文档中的 <a href=\"https://docs.nvidia.com/cuda/wsl-user-guide/index.html#ch03a-setting-up-cuda\">2.6 小节</a>。文档中提供了几种可选的方法，任选一种即可，如果全部执行一遍反而可能会出问题。我自己选择的是  <code>Installation of CUDA Toolkit using WSL-Ubuntu Package</code>  这一节中的方法。依照后续的指令来看， <code>WSL2</code>  需要安装  <code>Ubuntu-20.04</code>  的版本。</p>\n<p>首先依次执行以下指令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">wget</span> https://developer.download.nvidia.com/compute/cuda/repos/wsl-ubuntu/x86_64/cuda-wsl-ubuntu.pin</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> cuda-wsl-ubuntu.pin /etc/apt/preferences.d/cuda-repository-pin-600</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">wget</span> https://developer.download.nvidia.com/compute/cuda/11.4.0/local_installers/cuda-repo-wsl-ubuntu-11-4-local_11.4.0-1_amd64.deb</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">sudo</span> dpkg <span class=\"token parameter variable\">-i</span> cuda-repo-wsl-ubuntu-11-4-local_11.4.0-1_amd64.deb</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">sudo</span> apt-key <span class=\"token function\">add</span> /var/cuda-repo-wsl-ubuntu-11-4-local/7fa2af80.pub</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> cuda</pre></td></tr></table></figure><p>上述指令中安装的  <code>CUDA</code>  版本是  <code>11.4</code>  的，虽然我自己的  <code>Windows</code>  中安装的  <code>CUDA</code>  版本是  <code>10.1</code> ，但是好像不匹配也并无大碍。安装过程中可以将  <code>apt</code>  的源更换为阿里提供的镜像，具体更改方法可以参考此<a href=\"https://cloud.tencent.com/developer/article/1538304\">链接</a>。</p>\n<p>安装完成后，修改  <code>WSL2</code>  系统的环境变量。通常是在  <code>~/.bashrc</code>  文件中添加如下内容：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CUDA_HOME</span><span class=\"token operator\">=</span>/usr/local/cuda</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$CUDA_HOME</span>/bin</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">LD_LIBRARY_PATH</span><span class=\"token operator\">=</span>/usr/local/cuda-11.4/lib64<span class=\"token variable\">$&#123;LD_LIBRARY_PATH<span class=\"token operator\">:+</span><span class=\"token operator\">:</span>$&#123;LD_LIBRARY_PATH&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>我自己因为安装了  <code>zsh</code>  中断，所以我在  <code>~/.zshrc</code>  文件中添加上述内容。注意其中的  <code>CUDA</code>  版本号和自己的版本对应。</p>\n<p>上述修改完成后，在终端输入如下指令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nvcc <span class=\"token parameter variable\">--version</span></pre></td></tr></table></figure><p>如果得到如下类似的输出说明安装成功了：</p>\n<p><img loading=\"lazy\" data-src=\"/images/wsl2-cuda-configs-nvcc-version.jpg\" alt=\"nvcc version\" /></p>\n<h2 id=\"安装-cudnn\"><a class=\"anchor\" href=\"#安装-cudnn\">#</a> 安装  <code>cuDNN</code></h2>\n<p>在<a href=\"com/rdp/cudnn-download\">官网</a>下载和  <code>CUDA</code>  对应的  <code>cuDNN</code>  版本。可能需要预先注册账号。下载时选择  <code>cuDNN Library for Linux (x86)</code> 。</p>\n<p>下载完成后使用如下指令解压，并将文件移动到对应的文件夹：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> cudnn-11.4-linux-x64-v8.2.4.15.tgz</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> <span class=\"token parameter variable\">-P</span> cuda/lib64/libcudnn* /usr/local/cuda-11.4/lib64/</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span>  cuda/include/cudnn* /usr/local/cuda-11.4/include/</pre></td></tr></table></figure><p>然后为所有文件设置权限：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> a+r /usr/local/cuda-11.0/include/cudnn*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> a+r /usr/local/cuda-11.0/lib64/libcudnn*</pre></td></tr></table></figure><h2 id=\"验证安装\"><a class=\"anchor\" href=\"#验证安装\">#</a> 验证安装</h2>\n<p>执行以下指令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /usr/local/cuda/samples/4_Finance/BlackScholes</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">make</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>./BlackScholes</pre></td></tr></table></figure><p>如果得到  <code>Test passed</code>  的输出说明安装成功：</p>\n<p><img loading=\"lazy\" data-src=\"/images/wsl2-cuda-configs-check-cuda-installation.jpg\" alt=\"check cuda installation\" /></p>\n",
            "tags": [
                "Computer-Science",
                "CUDA",
                "Configs",
                "WSL"
            ]
        }
    ]
}